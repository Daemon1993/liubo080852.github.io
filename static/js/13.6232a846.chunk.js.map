{"version":3,"sources":["features/task_manage/push_article/PushArticle.scss","features/task_manage/push_article/EditableTagGroup.js","features/task_manage/push_article/PushDialog.js","features/task_manage/push_article/PushArticle.js"],"names":["module","exports","EditableTagGroup","state","tags","inputVisible","inputValue","editInputIndex","editInputValue","getResultTag","handleClose","removedTag","filter","tag","setState","showInput","input","focus","handleInputChange","e","target","value","handleInputConfirm","indexOf","handleEditInputChange","handleEditInputConfirm","newTags","saveInputRef","saveEditInputRef","editInput","this","map","index","ref","size","className","onChange","onBlur","onPressEnter","isLongTag","length","tagElem","closable","onClose","onDoubleClick","preventDefault","slice","title","type","onClick","PlusOutlined","React","Component","types","store","getState","login_reducer","dir_types","PushDialog","props","tag_cmp","useState","objectId","setValue","visible","onOk","result","type_id","onCancel","Group","dir","name","callback_results","headers","marked","require","setOptions","renderer","Renderer","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","highlight","str","lang","hljs","getLanguage","__","highlightAuto","PushArticle","handleOk","push_dialog_visible","requestBody","join","content","textareaValue","ServerNetWorkUtils","pushArticle","then","res","message","success","callback_tab_select","catch","error","handleCancel","onChangeTitle","evt","drop","dataTransfer","files","file","match","postImage2Server","pasteFileAction","cbd","clipboardData","ua","window","navigator","userAgent","items","kind","Number","i","item","blob","getAsFile","ts","Date","parse","key","id","CryptoJS","MD5","toString","formdata","FormData","append","axios","method","url","data","img","insert2TextEditer","left_input","obj","document","selection","createRange","text","selectionStart","selectionEnd","startPos","endPos","cursorPos","tmpStr","substring","handleTextareaChange","leftTRScorll","event","scrollHeight","clientHeight","scrollTop","scaleSize","right_show","styles","main","top_main","placeholder","input_title","onScroll","onDrop","onDragOver","onPasteCapture","dangerouslySetInnerHTML","__html"],"mappings":"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","file":"static/js/13.6232a846.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"src-features-task_manage-push_article-PushArticle__main--2vKVi\",\"top_main\":\"src-features-task_manage-push_article-PushArticle__top_main--1nJoW\",\"input_title\":\"src-features-task_manage-push_article-PushArticle__input_title--3SJco\",\"content\":\"src-features-task_manage-push_article-PushArticle__content--375SI\",\"left_input\":\"src-features-task_manage-push_article-PushArticle__left_input--2fT4-\",\"right_show\":\"src-features-task_manage-push_article-PushArticle__right_show--2HKGP\"};","import { Tag, Input, Tooltip } from 'antd';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport React from 'react';\r\n\r\nexport default class EditableTagGroup extends React.Component {\r\n  state = {\r\n    tags: ['React', '前端',],\r\n    inputVisible: false,\r\n    inputValue: '',\r\n    editInputIndex: -1,\r\n    editInputValue: '',\r\n  };\r\n\r\n \r\n  getResultTag=()=>{\r\n\r\n    return this.state.tags\r\n  }\r\n\r\n  handleClose = removedTag => {\r\n    const tags = this.state.tags.filter(tag => tag !== removedTag);\r\n    console.log(tags);\r\n    this.setState({ tags });\r\n  };\r\n\r\n  showInput = () => {\r\n    this.setState({ inputVisible: true }, () => this.input.focus());\r\n  };\r\n\r\n  handleInputChange = e => {\r\n    this.setState({ inputValue: e.target.value });\r\n  };\r\n\r\n  handleInputConfirm = () => {\r\n    const { inputValue } = this.state;\r\n    let { tags } = this.state;\r\n    if (inputValue && tags.indexOf(inputValue) === -1) {\r\n      tags = [...tags, inputValue];\r\n    }\r\n    console.log(tags);\r\n    this.setState({\r\n      tags,\r\n      inputVisible: false,\r\n      inputValue: '',\r\n    });\r\n  };\r\n\r\n  handleEditInputChange = e => {\r\n    this.setState({ editInputValue: e.target.value });\r\n  };\r\n\r\n  handleEditInputConfirm = () => {\r\n    this.setState(({ tags, editInputIndex, editInputValue }) => {\r\n      const newTags = [...tags];\r\n      newTags[editInputIndex] = editInputValue;\r\n\r\n      return {\r\n        tags: newTags,\r\n        editInputIndex: -1,\r\n        editInputValue: '',\r\n      };\r\n    });\r\n  };\r\n\r\n  saveInputRef = input => {\r\n    this.input = input;\r\n  };\r\n\r\n  saveEditInputRef = input => {\r\n    this.editInput = input;\r\n  };\r\n\r\n  render() {\r\n    const { tags, inputVisible, inputValue, editInputIndex, editInputValue } = this.state;\r\n    return (\r\n      <>\r\n        {tags.map((tag, index) => {\r\n          if (editInputIndex === index) {\r\n            return (\r\n              <Input\r\n                ref={this.saveEditInputRef}\r\n                key={tag}\r\n                size=\"small\"\r\n                className=\"tag-input\"\r\n                value={editInputValue}\r\n                onChange={this.handleEditInputChange}\r\n                onBlur={this.handleEditInputConfirm}\r\n                onPressEnter={this.handleEditInputConfirm}\r\n              />\r\n            );\r\n          }\r\n\r\n          const isLongTag = tag.length > 20;\r\n\r\n          const tagElem = (\r\n            <Tag\r\n              className=\"edit-tag\"\r\n              key={tag}\r\n              closable\r\n               onClose={() => this.handleClose(tag)}\r\n            >\r\n              <span\r\n                onDoubleClick={e => {\r\n                  if (index !== 0) {\r\n                    this.setState({ editInputIndex: index, editInputValue: tag }, () => {\r\n                      this.editInput.focus();\r\n                    });\r\n                    e.preventDefault();\r\n                  }\r\n                }}\r\n              >\r\n                {isLongTag ? `${tag.slice(0, 20)}...` : tag}\r\n              </span>\r\n            </Tag>\r\n          );\r\n          return isLongTag ? (\r\n            <Tooltip title={tag} key={tag}>\r\n              {tagElem}\r\n            </Tooltip>\r\n          ) : (\r\n            tagElem\r\n          );\r\n        })}\r\n        {inputVisible && (\r\n          <Input\r\n            ref={this.saveInputRef}\r\n            type=\"text\"\r\n            size=\"small\"\r\n            className=\"tag-input\"\r\n            value={inputValue}\r\n            onChange={this.handleInputChange}\r\n            onBlur={this.handleInputConfirm}\r\n            onPressEnter={this.handleInputConfirm}\r\n          />\r\n        )}\r\n        {!inputVisible && (\r\n          <Tag className=\"site-tag-plus\" onClick={this.showInput}>\r\n            <PlusOutlined /> New Tag\r\n          </Tag>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\n ","import store from \"@/features/store\";\r\nimport { Radio, Tag } from \"antd\";\r\nimport Modal from \"antd/lib/modal/Modal\";\r\nimport React from \"react\";\r\nimport EditableTagGroup from \"./EditableTagGroup\";\r\n\r\nlet types = store.getState().login_reducer.dir_types;\r\n\r\n\r\nexport default function PushDialog(props) {\r\n\r\n    const [value, setValue] = React.useState(types[0].objectId);\r\n   \r\n    \r\n    let tag_cmp;\r\n\r\n    const onChange = e => {\r\n        console.log('radio checked', e.target.value);\r\n        setValue(e.target.value);\r\n        // props.dir_select_callback(e.target.value)\r\n    };\r\n\r\n    const callback_results = (tags) => {\r\n        console.log(tags)\r\n    }\r\n\r\n    const onOk=()=>{\r\n        \r\n        let result={\r\n            type_id:value,\r\n            tags:tag_cmp.getResultTag()\r\n        }\r\n        props.onOk(result)\r\n    }\r\n\r\n    \r\n\r\n    return (\r\n\r\n        <Modal title=\"请确认相关信息\" visible={props.visible} onOk={onOk} onCancel={props.onCancel}>\r\n            <Radio.Group onChange={onChange} value={value}>\r\n                {types.map(dir => {\r\n                    return <Radio key={dir.objectId} value={dir.objectId}>{dir.name}</Radio>\r\n                })}\r\n            </Radio.Group>\r\n\r\n            <br />\r\n            <br />\r\n            <EditableTagGroup ref={(ref) => { tag_cmp = ref }} callback_results={callback_results} />\r\n\r\n        </Modal>\r\n    )\r\n\r\n\r\n}","import React from \"react\";\r\n\r\nimport styles from './PushArticle.scss';\r\n\r\nimport './markdown10.scss';\r\n\r\nimport CryptoJS from \"crypto-js\";\r\nimport hljs from \"highlight.js\";\r\nimport 'highlight.js/styles/atom-one-dark.css';\r\nimport axios from \"axios\";\r\nimport { Button, message } from \"antd\";\r\n\r\nimport 'antd/dist/antd.css';\r\nimport PushDialog from \"./PushDialog\";\r\nimport ServerNetWorkUtils from \"@/data_model/ServerNetWorkUtils\";\r\n\r\nconst headers = {\r\n    'Content-Type': 'multipart/form-data;charset=UTF-8'\r\n}\r\n\r\n\r\nlet ttt = '';\r\n\r\n\r\nvar marked = require('marked');\r\nmarked.setOptions({\r\n    renderer: new marked.Renderer(),\r\n    gfm: true,\r\n    tables: true,\r\n    breaks: true,\r\n    pedantic: false,\r\n    sanitize: false,\r\n    smartLists: true,\r\n    smartypants: false,\r\n    highlight: function (str, lang) {\r\n        if (lang && hljs.getLanguage(lang)) {\r\n            try {\r\n                return hljs.highlight(lang, str).value;\r\n            } catch (__) {\r\n            }\r\n        }\r\n\r\n        try {\r\n            return hljs.highlightAuto(str).value;\r\n        } catch (__) {\r\n        }\r\n\r\n        return ''; // use e\r\n    }\r\n});\r\n\r\nexport default class PushArticle extends React.Component {\r\n\r\n    constructor(props) {\r\n        console.log(\"ManageHome\")\r\n        super(props)\r\n        this.state = {\r\n            textareaValue: \"\",\r\n            push_dialog_visible:false,\r\n            title:\"\"\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        console.log(\"PushArticle componentDidMount\")\r\n    }\r\n\r\n    render() {\r\n         let title = marked('# ' + this.state.title);\r\n        let result = marked(this.state.textareaValue);\r\n\r\n        return (\r\n            <div className={styles.main}>\r\n                <div className={styles.top_main}>\r\n                    <input value={this.state.title} onChange={this.onChangeTitle} placeholder=\"请输入标题\" className={styles.input_title} />\r\n                    <Button onClick={this.pushArticle} >发布</Button>\r\n                </div>\r\n\r\n                <div className={styles.content}>\r\n                    <textarea\r\n                        ref={(ref) => { this.left_input = ref }}\r\n                        onScroll={this.leftTRScorll}\r\n                        onDrop={this.drop}\r\n                        onDragOver={(event) => event.preventDefault()}\r\n                        onPasteCapture={this.pasteFileAction}\r\n                        className={styles.left_input} value={this.state.textareaValue} onChange={this.handleTextareaChange} />\r\n\r\n                    <div ref={(ref) => { this.right_show = ref }} className={styles.right_show} dangerouslySetInnerHTML={{ __html: title+result }} >\r\n                    </div>\r\n                </div>\r\n\r\n                <PushDialog  visible={this.state.push_dialog_visible} onOk={this.handleOk} onCancel={this.handleCancel} />\r\n            </div>\r\n\r\n        )\r\n    }\r\n\r\n    handleOk = (result) => {\r\n        console.log(result)\r\n        this.setState({\r\n            push_dialog_visible:false\r\n        })\r\n    \r\n        \r\n        console.log(\"真正开始上传文章\")\r\n        let requestBody={\r\n            title:this.state.title,\r\n            tags:result.tags.join(\",\"),\r\n            type_id:result.type_id,\r\n            content:this.state.textareaValue\r\n        }\r\n        console.log(requestBody)\r\n        ServerNetWorkUtils.pushArticle(requestBody)\r\n        .then(res=>{\r\n            console.log(res)\r\n            if(res.objectId){\r\n                message.success('发布成功...',1).then(()=>{\r\n                    console.log(this)\r\n                    //通知父组件 切换到文章管理\r\n                    this.props.callback_tab_select(1)\r\n                });\r\n            }\r\n        }).catch(error=>{\r\n            message.error(\"上传失败 稍后再试\");\r\n        })\r\n    };\r\n\r\n    handleCancel = () => {\r\n        this.setState({\r\n            push_dialog_visible:false\r\n        })\r\n    };\r\n\r\n    pushArticle = () => {\r\n        console.log(\"发布文章 弹出确认信息\")\r\n        this.setState({\r\n            push_dialog_visible:true\r\n        })\r\n    }\r\n\r\n    onChangeTitle=(evt)=>{\r\n        this.setState({\r\n            title:evt.target.value\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 拖拽图片上传\r\n     * @param {*} e \r\n     */\r\n    drop = (e) => {\r\n        // 操作系统拖放文件到浏览器需要取消默认行为\r\n        e.preventDefault();\r\n\r\n        for (let file of e.dataTransfer.files) {\r\n\r\n            if (file && file.type.match('image.*')) {\r\n                this.postImage2Server(file)\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 粘贴图片/文件\r\n     * @param {*} evt \r\n     */\r\n    pasteFileAction = (e) => {\r\n        var cbd = e.clipboardData;\r\n        var ua = window.navigator.userAgent;\r\n\r\n\r\n        if (!(e.clipboardData && e.clipboardData.items)) {\r\n            console.log(\"无法获取粘贴内容\")\r\n            return;\r\n        }\r\n\r\n        // Mac平台下Chrome49版本以下 复制Finder中的文件的Bug Hack掉\r\n        if (cbd.items && cbd.items.length === 2 && cbd.items[0].kind === \"string\" && cbd.items[1].kind === \"file\" &&\r\n            cbd.types && cbd.types.length === 2 && cbd.types[0] === \"text/plain\" && cbd.types[1] === \"Files\" &&\r\n            ua.match(/Macintosh/i) && Number(ua.match(/Chrome\\/(\\d{2})/i)[1]) < 49) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < cbd.items.length; i++) {\r\n            var item = cbd.items[i];\r\n            console.log(item)\r\n            if (item.kind === \"file\") {\r\n                var blob = item.getAsFile();\r\n                if (blob.size === 0) {\r\n                    return;\r\n                }\r\n\r\n                if (blob.name.indexOf(\"image\") !== -1) {\r\n                    console.log(blob);\r\n                    this.postImage2Server(blob)\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 上传文件\r\n     * @param { }} file \r\n     */\r\n    postImage2Server = (file) => {\r\n        console.log(\"postImage2Server\")\r\n        let id = 8192;\r\n        let ts = Date.parse(new Date()) / 1000;\r\n        let key = id + '-' + ttt + '-' + ts\r\n\r\n        key = CryptoJS.MD5(key).toString()\r\n\r\n\r\n        let formdata = new FormData();\r\n        formdata.append('file', file);\r\n\r\n        formdata.append('id', id);\r\n        formdata.append('ts', ts);\r\n        formdata.append('categories', \"jump-react\");\r\n        formdata.append('sign', key);\r\n\r\n        axios({\r\n            method: 'post',\r\n            url: \"https://api.superbed.cn/upload\",\r\n            headers: headers,\r\n            data: formdata\r\n        }).then(res => {\r\n            let url = res.data.url\r\n            console.log(\"上传成功 url \" + url)\r\n\r\n            let img = '![image](' + url + ')\\n';\r\n\r\n            this.insert2TextEditer(this.left_input, img);\r\n\r\n\r\n            this.setState({\r\n                textareaValue: this.left_input.value,\r\n            });\r\n\r\n        }).catch(error => {\r\n            console.log(error)\r\n        })\r\n    }\r\n\r\n    insert2TextEditer = (obj, img) => {\r\n        console.log(\"insert2TextEditer \" + img)\r\n\r\n        if (document.selection) {\r\n            var sel = document.selection.createRange();\r\n            sel.text = img;\r\n        } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {\r\n            var startPos = obj.selectionStart,\r\n                endPos = obj.selectionEnd,\r\n                cursorPos = startPos,\r\n                tmpStr = obj.value;\r\n            obj.value = tmpStr.substring(0, startPos) + img + tmpStr.substring(endPos, tmpStr.length);\r\n            cursorPos += img.length;\r\n            obj.selectionStart = obj.selectionEnd = cursorPos;\r\n        } else {\r\n            obj.value += img;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    handleTextareaChange = (evt) => {\r\n        this.setState({\r\n            textareaValue: evt.target.value\r\n        })\r\n    }\r\n\r\n    leftTRScorll = (event) => {\r\n\r\n        if (event.target.scrollHeight - event.target.clientHeight === event.target.scrollTop) {\r\n            console.log('底部');\r\n            this.right_show.scrollTop = this.right_show.scrollHeight - this.right_show.clientHeight;\r\n            return;\r\n        }\r\n        let mdDivHeight = this.right_show.scrollHeight;\r\n        let textAreaHeight = this.left_input.scrollHeight;\r\n        let scaleSize = mdDivHeight / textAreaHeight;\r\n\r\n        if (scaleSize > 1) {\r\n            scaleSize = scaleSize * 0.9;\r\n        }\r\n\r\n        this.right_show.scrollTop = event.target.scrollTop * scaleSize;\r\n    }\r\n}\r\n"],"sourceRoot":""}