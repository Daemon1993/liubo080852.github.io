{"version":3,"sources":["features/task_manage/push_article/PushArticle.scss","features/task_manage/push_article/EditableTagGroup.js","features/task_manage/push_article/PushDialog.js","features/task_manage/push_article/PushArticle.js"],"names":["module","exports","EditableTagGroup","state","tags","inputVisible","inputValue","editInputIndex","editInputValue","getResultTag","handleClose","removedTag","filter","tag","setState","showInput","input","focus","handleInputChange","e","target","value","handleInputConfirm","indexOf","handleEditInputChange","handleEditInputConfirm","newTags","saveInputRef","saveEditInputRef","editInput","this","map","index","ref","size","className","onChange","onBlur","onPressEnter","isLongTag","length","tagElem","closable","onClose","onDoubleClick","preventDefault","slice","title","type","onClick","PlusOutlined","React","Component","types","store","getState","login_reducer","dir_types","PushDialog","props","tag_cmp","useState","objectId","setValue","type_item_id","setTypeItemId","showTypeItems","setshowTypeItems","type_items","setTypeItems","useEffect","ServerNetWorkUtils","getAllTitlesTB_Type_Items","then","res","catch","error","visible","onOk","result","type_id","onCancel","Group","dir","name","type_item","callback_results","mkRenderTimer","headers","ttt","login_user","marked","require","setOptions","renderer","Renderer","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","highlight","str","lang","hljs","getLanguage","__","highlightAuto","PushArticle","updateInputValue","input_value","textareaValue","clearTimeout","setTimeout","_html_str","handleTextareaChange","evt","handleOk","push_dialog_visible","requestBody","join","content","pushArticle","message","success","callback_tab_select","handleCancel","onChangeTitle","drop","dataTransfer","files","file","match","postImage2Server","pasteFileAction","cbd","clipboardData","ua","window","navigator","userAgent","items","kind","Number","i","item","blob","getAsFile","ts","Date","parse","key","id","CryptoJS","MD5","toString","formdata","FormData","append","axios","method","url","data","img","insert2TextEditer","left_input","obj","document","selection","createRange","text","selectionStart","selectionEnd","startPos","endPos","cursorPos","tmpStr","substring","leftTRScorll","event","scrollHeight","clientHeight","scrollTop","scaleSize","right_show","styles","main","top_main","placeholder","input_title","onScroll","onDrop","onDragOver","onPasteCapture","dangerouslySetInnerHTML","__html"],"mappings":"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","file":"static/js/15.72f63e39.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"src-features-task_manage-push_article-PushArticle__main--2vKVi\",\"top_main\":\"src-features-task_manage-push_article-PushArticle__top_main--1nJoW\",\"input_title\":\"src-features-task_manage-push_article-PushArticle__input_title--3SJco\",\"content\":\"src-features-task_manage-push_article-PushArticle__content--375SI\",\"left_input\":\"src-features-task_manage-push_article-PushArticle__left_input--2fT4-\",\"right_show\":\"src-features-task_manage-push_article-PushArticle__right_show--2HKGP\"};","import { Tag, Input, Tooltip } from 'antd';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport React from 'react';\r\n\r\nexport default class EditableTagGroup extends React.Component {\r\n  state = {\r\n    tags: ['React', '前端',],\r\n    inputVisible: false,\r\n    inputValue: '',\r\n    editInputIndex: -1,\r\n    editInputValue: '',\r\n  };\r\n\r\n \r\n  getResultTag=()=>{\r\n\r\n    return this.state.tags\r\n  }\r\n\r\n  handleClose = removedTag => {\r\n    const tags = this.state.tags.filter(tag => tag !== removedTag);\r\n    console.log(tags);\r\n    this.setState({ tags });\r\n  };\r\n\r\n  showInput = () => {\r\n    this.setState({ inputVisible: true }, () => this.input.focus());\r\n  };\r\n\r\n  handleInputChange = e => {\r\n    this.setState({ inputValue: e.target.value });\r\n  };\r\n\r\n  handleInputConfirm = () => {\r\n    const { inputValue } = this.state;\r\n    let { tags } = this.state;\r\n    if (inputValue && tags.indexOf(inputValue) === -1) {\r\n      tags = [...tags, inputValue];\r\n    }\r\n    console.log(tags);\r\n    this.setState({\r\n      tags,\r\n      inputVisible: false,\r\n      inputValue: '',\r\n    });\r\n  };\r\n\r\n  handleEditInputChange = e => {\r\n    this.setState({ editInputValue: e.target.value });\r\n  };\r\n\r\n  handleEditInputConfirm = () => {\r\n    this.setState(({ tags, editInputIndex, editInputValue }) => {\r\n      const newTags = [...tags];\r\n      newTags[editInputIndex] = editInputValue;\r\n\r\n      return {\r\n        tags: newTags,\r\n        editInputIndex: -1,\r\n        editInputValue: '',\r\n      };\r\n    });\r\n  };\r\n\r\n  saveInputRef = input => {\r\n    this.input = input;\r\n  };\r\n\r\n  saveEditInputRef = input => {\r\n    this.editInput = input;\r\n  };\r\n\r\n  render() {\r\n    const { tags, inputVisible, inputValue, editInputIndex, editInputValue } = this.state;\r\n    return (\r\n      <>\r\n        {tags.map((tag, index) => {\r\n          if (editInputIndex === index) {\r\n            return (\r\n              <Input\r\n                ref={this.saveEditInputRef}\r\n                key={tag}\r\n                size=\"small\"\r\n                className=\"tag-input\"\r\n                value={editInputValue}\r\n                onChange={this.handleEditInputChange}\r\n                onBlur={this.handleEditInputConfirm}\r\n                onPressEnter={this.handleEditInputConfirm}\r\n              />\r\n            );\r\n          }\r\n\r\n          const isLongTag = tag.length > 20;\r\n\r\n          const tagElem = (\r\n            <Tag\r\n              className=\"edit-tag\"\r\n              key={tag}\r\n              closable\r\n               onClose={() => this.handleClose(tag)}\r\n            >\r\n              <span\r\n                onDoubleClick={e => {\r\n                  if (index !== 0) {\r\n                    this.setState({ editInputIndex: index, editInputValue: tag }, () => {\r\n                      this.editInput.focus();\r\n                    });\r\n                    e.preventDefault();\r\n                  }\r\n                }}\r\n              >\r\n                {isLongTag ? `${tag.slice(0, 20)}...` : tag}\r\n              </span>\r\n            </Tag>\r\n          );\r\n          return isLongTag ? (\r\n            <Tooltip title={tag} key={tag}>\r\n              {tagElem}\r\n            </Tooltip>\r\n          ) : (\r\n            tagElem\r\n          );\r\n        })}\r\n        {inputVisible && (\r\n          <Input\r\n            ref={this.saveInputRef}\r\n            type=\"text\"\r\n            size=\"small\"\r\n            className=\"tag-input\"\r\n            value={inputValue}\r\n            onChange={this.handleInputChange}\r\n            onBlur={this.handleInputConfirm}\r\n            onPressEnter={this.handleInputConfirm}\r\n          />\r\n        )}\r\n        {!inputVisible && (\r\n          <Tag className=\"site-tag-plus\" onClick={this.showInput}>\r\n            <PlusOutlined /> New Tag\r\n          </Tag>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\n ","import ServerNetWorkUtils from \"@/data_model/ServerNetWorkUtils\";\r\nimport store from \"@/features/store\";\r\nimport { Radio, Tag } from \"antd\";\r\nimport Modal from \"antd/lib/modal/Modal\";\r\nimport React, { useEffect } from \"react\";\r\nimport EditableTagGroup from \"./EditableTagGroup\";\r\n\r\nlet types = store.getState().login_reducer.dir_types;\r\n\r\n\r\nexport default function PushDialog(props) {\r\n\r\n    const [value, setValue] = React.useState(types[0].objectId);\r\n    const [type_item_id, setTypeItemId] = React.useState(\"\");\r\n\r\n    const [showTypeItems, setshowTypeItems] = React.useState(false)\r\n    const [type_items, setTypeItems] = React.useState([])\r\n\r\n    let tag_cmp;\r\n\r\n    let type_items_effect=0\r\n\r\n    useEffect(()=>{\r\n        ServerNetWorkUtils.getAllTitlesTB_Type_Items(\"514b01f381\")\r\n        .then(res=>{\r\n            console.log(res)\r\n            setTypeItems(res)\r\n        }).catch(error=>{\r\n            console.log(error)\r\n        })\r\n\r\n    },[type_items_effect])\r\n\r\n    const onChange = e => {\r\n        console.log('radio checked', e.target.value);\r\n        if (e.target.value == \"514b01f381\") {\r\n            console.log(\"选择技术文章 显示二级分类\")\r\n            setshowTypeItems(true)\r\n        } else {\r\n            setshowTypeItems(false)\r\n        }\r\n        setValue(e.target.value);\r\n        // props.dir_select_callback(e.target.value)\r\n    };\r\n    const onChange1 = e => {\r\n        console.log('radio checked', e.target.value);\r\n\r\n        setTypeItemId(e.target.value);\r\n        // props.dir_select_callback(e.target.value)\r\n    };\r\n\r\n    const callback_results = (tags) => {\r\n        console.log(tags)\r\n    }\r\n\r\n    const onOk = () => {\r\n\r\n        let result = {\r\n            type_id: value,\r\n            type_item_id: type_item_id,\r\n            tags: tag_cmp.getResultTag()\r\n        }\r\n        // console.log(result)\r\n        props.onOk(result)\r\n    }\r\n\r\n\r\n\r\n    return (\r\n\r\n        <Modal title=\"请确认相关信息\" visible={props.visible} onOk={onOk} onCancel={props.onCancel}>\r\n            <Radio.Group onChange={onChange} value={value}>\r\n                {types.map(dir => {\r\n                    return <Radio key={dir.objectId} value={dir.objectId}>{dir.name}</Radio>\r\n                })}\r\n            </Radio.Group>\r\n\r\n            {showTypeItems ?\r\n\r\n\r\n                <div>\r\n                    <br />\r\n                    <br />\r\n                    <Radio.Group onChange={onChange1} value={type_item_id}>\r\n                        {type_items.map(type_item => {\r\n                            return <Radio key={type_item.objectId} value={type_item.objectId}>{type_item.name}</Radio>\r\n                        })}\r\n                    </Radio.Group>\r\n                </div>\r\n\r\n                : null}\r\n\r\n\r\n            <br />\r\n            <br />\r\n            <EditableTagGroup ref={(ref) => { tag_cmp = ref }} callback_results={callback_results} />\r\n\r\n        </Modal>\r\n    )\r\n\r\n\r\n}","import React from \"react\";\r\n\r\nimport styles from './PushArticle.scss';\r\n\r\nimport './markdown10.scss';\r\n\r\nimport CryptoJS from \"crypto-js\";\r\nimport hljs from \"highlight.js\";\r\nimport 'highlight.js/styles/atom-one-dark.css';\r\nimport axios from \"axios\";\r\nimport { Button, message } from \"antd\";\r\n\r\nimport 'antd/dist/antd.css';\r\nimport PushDialog from \"./PushDialog\";\r\nimport ServerNetWorkUtils from \"@/data_model/ServerNetWorkUtils\";\r\nimport store from \"@/features/store\";\r\n\r\nconst headers = {\r\n    'Content-Type': 'multipart/form-data;charset=UTF-8'\r\n}\r\n\r\nlet ttt = store.getState().login_reducer.login_user.ttt;\r\n\r\n\r\n\r\n\r\n\r\nvar marked = require('marked');\r\nmarked.setOptions({\r\n    renderer: new marked.Renderer(),\r\n    gfm: true,\r\n    tables: true,\r\n    breaks: true,\r\n    pedantic: false,\r\n    sanitize: false,\r\n    smartLists: true,\r\n    smartypants: false,\r\n    highlight: function (str, lang) {\r\n        if (lang && hljs.getLanguage(lang)) {\r\n            try {\r\n                return hljs.highlight(lang, str).value;\r\n            } catch (__) {\r\n            }\r\n        }\r\n\r\n        try {\r\n            return hljs.highlightAuto(str).value;\r\n        } catch (__) {\r\n        }\r\n\r\n        return ''; // use e\r\n    }\r\n});\r\n\r\nlet mkRenderTimer\r\nexport default class PushArticle extends React.Component {\r\n\r\n    constructor(props) {\r\n        console.log(\"ManageHome\")\r\n        super(props)\r\n        this.state = {\r\n            textareaValue: \"\",\r\n            push_dialog_visible: false,\r\n            title: \"\",\r\n            _html_str: \"\",\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        console.log(\"PushArticle componentDidMount\")\r\n    }\r\n\r\n    render() {\r\n        let title = marked('# ' + this.state.title);\r\n\r\n        return (\r\n            <div className={styles.main}>\r\n                <div className={styles.top_main}>\r\n                    <input value={this.state.title} onChange={this.onChangeTitle} placeholder=\"请输入标题\" className={styles.input_title} />\r\n                    <Button onClick={this.pushArticle} >发布</Button>\r\n                </div>\r\n\r\n                <div className={styles.content}>\r\n                    <textarea\r\n                        ref={(ref) => { this.left_input = ref }}\r\n                        onScroll={this.leftTRScorll}\r\n                        onDrop={this.drop}\r\n                        onDragOver={(event) => event.preventDefault()}\r\n                        onPasteCapture={this.pasteFileAction}\r\n                        className={styles.left_input} value={this.state.textareaValue} onChange={this.handleTextareaChange} />\r\n\r\n                    <div ref={(ref) => { this.right_show = ref }} className={styles.right_show}\r\n                        dangerouslySetInnerHTML={{ __html: title + this.state._html_str }} >\r\n                    </div>\r\n                </div>\r\n\r\n                <PushDialog visible={this.state.push_dialog_visible} onOk={this.handleOk} onCancel={this.handleCancel} />\r\n            </div>\r\n\r\n        )\r\n    }\r\n\r\n    updateInputValue = (input_value) => {\r\n        this.setState({\r\n            textareaValue: input_value\r\n        })\r\n\r\n        if (mkRenderTimer) clearTimeout(mkRenderTimer);\r\n        mkRenderTimer = setTimeout(() => {\r\n\r\n            this.setState({\r\n                _html_str: marked(this.state.textareaValue)\r\n            })\r\n\r\n            clearTimeout(mkRenderTimer)\r\n        }, 500)\r\n    }\r\n    handleTextareaChange = (evt) => {\r\n\r\n\r\n        this.updateInputValue(evt.target.value)\r\n\r\n\r\n    }\r\n\r\n    handleOk = (result) => {\r\n        console.log(result)\r\n        this.setState({\r\n            push_dialog_visible: false\r\n        })\r\n\r\n\r\n        console.log(\"真正开始上传文章\")\r\n        let requestBody = {\r\n            title: this.state.title,\r\n            tags: result.tags.join(\",\"),\r\n            type_id: result.type_id,\r\n            type_item_id: result.type_item_id,\r\n            content: this.state.textareaValue\r\n        }\r\n        console.log(requestBody)\r\n        ServerNetWorkUtils.pushArticle(requestBody)\r\n            .then(res => {\r\n                console.log(res)\r\n                if (res.objectId) {\r\n                    message.success('发布成功...', 1).then(() => {\r\n                        console.log(this)\r\n                        //通知父组件 切换到文章管理\r\n                        this.props.callback_tab_select(1)\r\n                    });\r\n                }\r\n            }).catch(error => {\r\n                message.error(\"上传失败 稍后再试\");\r\n            })\r\n    };\r\n\r\n    handleCancel = () => {\r\n        this.setState({\r\n            push_dialog_visible: false\r\n        })\r\n    };\r\n\r\n    pushArticle = () => {\r\n        console.log(\"发布文章 弹出确认信息\")\r\n        this.setState({\r\n            push_dialog_visible: true\r\n        })\r\n    }\r\n\r\n    onChangeTitle = (evt) => {\r\n        this.setState({\r\n            title: evt.target.value\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 拖拽图片上传\r\n     * @param {*} e \r\n     */\r\n    drop = (e) => {\r\n        // 操作系统拖放文件到浏览器需要取消默认行为\r\n        e.preventDefault();\r\n\r\n        for (let file of e.dataTransfer.files) {\r\n\r\n            if (file && file.type.match('image.*')) {\r\n                this.postImage2Server(file)\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 粘贴图片/文件\r\n     * @param {*} evt \r\n     */\r\n    pasteFileAction = (e) => {\r\n        var cbd = e.clipboardData;\r\n        var ua = window.navigator.userAgent;\r\n\r\n\r\n        if (!(e.clipboardData && e.clipboardData.items)) {\r\n            console.log(\"无法获取粘贴内容\")\r\n            return;\r\n        }\r\n\r\n        // Mac平台下Chrome49版本以下 复制Finder中的文件的Bug Hack掉\r\n        if (cbd.items && cbd.items.length === 2 && cbd.items[0].kind === \"string\" && cbd.items[1].kind === \"file\" &&\r\n            cbd.types && cbd.types.length === 2 && cbd.types[0] === \"text/plain\" && cbd.types[1] === \"Files\" &&\r\n            ua.match(/Macintosh/i) && Number(ua.match(/Chrome\\/(\\d{2})/i)[1]) < 49) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < cbd.items.length; i++) {\r\n            var item = cbd.items[i];\r\n            console.log(item)\r\n            if (item.kind === \"file\") {\r\n                var blob = item.getAsFile();\r\n                if (blob.size === 0) {\r\n                    return;\r\n                }\r\n\r\n                if (blob.name.indexOf(\"image\") !== -1) {\r\n                    console.log(blob);\r\n                    this.postImage2Server(blob)\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 上传文件\r\n     * @param { }} file \r\n     */\r\n    postImage2Server = (file) => {\r\n        console.log(\"postImage2Server\")\r\n\r\n        let id = 8192;\r\n        let ts = Date.parse(new Date()) / 1000;\r\n        let key = id + '-' + ttt + '-' + ts\r\n\r\n        key = CryptoJS.MD5(key).toString()\r\n\r\n\r\n        let formdata = new FormData();\r\n        formdata.append('file', file);\r\n\r\n        formdata.append('id', id);\r\n        formdata.append('ts', ts);\r\n        formdata.append('categories', \"jump-react\");\r\n        formdata.append('sign', key);\r\n\r\n        axios({\r\n            method: 'post',\r\n            url: \"https://api.superbed.cn/upload\",\r\n            headers: headers,\r\n            data: formdata\r\n        }).then(res => {\r\n            let url = res.data.url\r\n            console.log(\"上传成功 url \" + url)\r\n\r\n            let img = '![image](' + url + ')\\n';\r\n\r\n            this.insert2TextEditer(this.left_input, img);\r\n\r\n\r\n            this.updateInputValue(this.left_input.value)\r\n\r\n\r\n        }).catch(error => {\r\n            console.log(error)\r\n        })\r\n    }\r\n\r\n    insert2TextEditer = (obj, img) => {\r\n        console.log(\"insert2TextEditer \" + img)\r\n\r\n        if (document.selection) {\r\n            var sel = document.selection.createRange();\r\n            sel.text = img;\r\n        } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {\r\n            var startPos = obj.selectionStart,\r\n                endPos = obj.selectionEnd,\r\n                cursorPos = startPos,\r\n                tmpStr = obj.value;\r\n            obj.value = tmpStr.substring(0, startPos) + img + tmpStr.substring(endPos, tmpStr.length);\r\n            cursorPos += img.length;\r\n            obj.selectionStart = obj.selectionEnd = cursorPos;\r\n        } else {\r\n            obj.value += img;\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    leftTRScorll = (event) => {\r\n\r\n        if (event.target.scrollHeight - event.target.clientHeight === event.target.scrollTop) {\r\n            console.log('底部');\r\n            this.right_show.scrollTop = this.right_show.scrollHeight - this.right_show.clientHeight;\r\n            return;\r\n        }\r\n        let mdDivHeight = this.right_show.scrollHeight;\r\n        let textAreaHeight = this.left_input.scrollHeight;\r\n        let scaleSize = mdDivHeight / textAreaHeight;\r\n\r\n        if (scaleSize > 1) {\r\n            scaleSize = scaleSize * 0.9;\r\n        }\r\n\r\n        this.right_show.scrollTop = event.target.scrollTop * scaleSize;\r\n    }\r\n}\r\n"],"sourceRoot":""}