{"version":3,"sources":["features/task_manage/manage.scss","features/task_manage/ManageHome.js"],"names":["module","exports","headers","marked","require","setOptions","renderer","Renderer","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","highlight","str","lang","hljs","getLanguage","value","__","highlightAuto","ManageHome","props","drop","e","preventDefault","dataTransfer","files","file","type","match","postImage2Server","pasteFileAction","cbd","clipboardData","ua","window","navigator","userAgent","items","length","kind","types","Number","i","item","console","log","blob","getAsFile","size","name","indexOf","ts","Date","parse","key","id","CryptoJS","MD5","toString","formdata","FormData","append","axios","method","url","data","then","res","img","insert2TextEditer","left_input","setState","textareaValue","catch","error","obj","document","selection","createRange","text","selectionStart","selectionEnd","startPos","endPos","cursorPos","tmpStr","substring","handleTextareaChange","evt","target","leftTRScorll","event","scrollHeight","clientHeight","scrollTop","right_show","scaleSize","state","result","this","className","styles","main","top","content","ref","onScroll","onDrop","onDragOver","onPasteCapture","onChange","dangerouslySetInnerHTML","__html","React","Component"],"mappings":"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","file":"static/js/6.e11a364e.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"src-features-task_manage-manage__main--1ttAI\",\"top\":\"src-features-task_manage-manage__top--J-qxG\",\"content\":\"src-features-task_manage-manage__content--3Cdqj\",\"left_input\":\"src-features-task_manage-manage__left_input--33Gb9\",\"right_show\":\"src-features-task_manage-manage__right_show--3IPKz\"};","/***\r\n * 编辑器功能\r\n */\r\n\r\nimport React from \"react\";\r\nimport styles from './manage.scss';\r\nimport './markdown10.scss';\r\n\r\n\r\nimport hljs from \"highlight.js\";\r\nimport 'highlight.js/styles/atom-one-dark.css';\r\nimport axios from \"axios\";\r\n\r\nimport CryptoJS from \"crypto-js\";\r\n\r\n\r\n\r\n\r\nconst headers = {\r\n    'Content-Type': 'multipart/form-data;charset=UTF-8'\r\n}\r\n\r\nlet ttt = '';\r\n\r\nvar marked = require('marked');\r\nmarked.setOptions({\r\n    renderer: new marked.Renderer(),\r\n    gfm: true,\r\n    tables: true,\r\n    breaks: true,\r\n    pedantic: false,\r\n    sanitize: false,\r\n    smartLists: true,\r\n    smartypants: false,\r\n    highlight: function (str, lang) {\r\n        if (lang && hljs.getLanguage(lang)) {\r\n            try {\r\n                return hljs.highlight(lang, str).value;\r\n            } catch (__) {\r\n            }\r\n        }\r\n\r\n        try {\r\n            return hljs.highlightAuto(str).value;\r\n        } catch (__) {\r\n        }\r\n\r\n        return ''; // use e\r\n    }\r\n});\r\n\r\nexport default class ManageHome extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            textareaValue: \"\",\r\n        }\r\n    }\r\n\r\n \r\n    render() {\r\n        var result = marked(this.state.textareaValue); // result is a String\r\n        return (\r\n            <div className={styles.main}>\r\n                <div className={styles.top}>\r\n                    <h1>Jump 编辑文章</h1>\r\n                </div>\r\n                <div className={styles.content}>\r\n                    <textarea\r\n                        ref={(ref) => { this.left_input = ref }}\r\n                        onScroll={this.leftTRScorll}\r\n                        onDrop={this.drop}\r\n                        onDragOver={(event) => event.preventDefault()}\r\n                        onPasteCapture={this.pasteFileAction}\r\n                        className={styles.left_input} value={this.state.textareaValue} onChange={this.handleTextareaChange} />\r\n\r\n                    <div ref={(ref) => { this.right_show = ref }} className={styles.right_show} dangerouslySetInnerHTML={{ __html: result }} >\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        )\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 拖拽图片上传\r\n     * @param {*} e \r\n     */\r\n    drop = (e) => {\r\n        // 操作系统拖放文件到浏览器需要取消默认行为\r\n        e.preventDefault();\r\n\r\n        for (let file of e.dataTransfer.files) {\r\n\r\n            if (file && file.type.match('image.*')) {\r\n                this.postImage2Server(file)\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 粘贴图片/文件\r\n     * @param {*} evt \r\n     */\r\n    pasteFileAction = (e) => {\r\n        var cbd = e.clipboardData;\r\n        var ua = window.navigator.userAgent;\r\n\r\n\r\n        if (!(e.clipboardData && e.clipboardData.items)) {\r\n            console.log(\"无法获取粘贴内容\")\r\n            return;\r\n        }\r\n\r\n        // Mac平台下Chrome49版本以下 复制Finder中的文件的Bug Hack掉\r\n        if (cbd.items && cbd.items.length === 2 && cbd.items[0].kind === \"string\" && cbd.items[1].kind === \"file\" &&\r\n            cbd.types && cbd.types.length === 2 && cbd.types[0] === \"text/plain\" && cbd.types[1] === \"Files\" &&\r\n            ua.match(/Macintosh/i) && Number(ua.match(/Chrome\\/(\\d{2})/i)[1]) < 49) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < cbd.items.length; i++) {\r\n            var item = cbd.items[i];\r\n            console.log(item)\r\n            if (item.kind === \"file\") {\r\n                var blob = item.getAsFile();\r\n                if (blob.size === 0) {\r\n                    return;\r\n                }\r\n\r\n                if (blob.name.indexOf(\"image\") !== -1) {\r\n                    console.log(blob);\r\n                    this.postImage2Server(blob)\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 上传文件\r\n     * @param { }} file \r\n     */\r\n    postImage2Server = (file) => {\r\n        console.log(\"postImage2Server\")\r\n        let id = 8192;\r\n        let ts = Date.parse(new Date()) / 1000;\r\n        let key = id + '-' + ttt + '-' + ts\r\n\r\n        key = CryptoJS.MD5(key).toString()\r\n\r\n\r\n        let formdata = new FormData();\r\n        formdata.append('file', file);\r\n\r\n        formdata.append('id', id);\r\n        formdata.append('ts', ts);\r\n        formdata.append('categories', \"jump-react\");\r\n        formdata.append('sign', key);\r\n\r\n        axios({\r\n            method: 'post',\r\n            url: \"https://api.superbed.cn/upload\",\r\n            headers: headers,\r\n            data: formdata\r\n        }).then(res => {\r\n            let url = res.data.url\r\n            console.log(\"上传成功 url \" + url)\r\n\r\n            let img = '![image](' + url + ')\\n';\r\n\r\n            this.insert2TextEditer(this.left_input, img);\r\n\r\n\r\n            this.setState({\r\n                textareaValue: this.left_input.value,\r\n            });\r\n\r\n        }).catch(error => {\r\n            console.log(error)\r\n        })\r\n    }\r\n\r\n    insert2TextEditer = (obj, img) => {\r\n        console.log(\"insert2TextEditer \" + img)\r\n\r\n        if (document.selection) {\r\n            var sel = document.selection.createRange();\r\n            sel.text = img;\r\n        } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {\r\n            var startPos = obj.selectionStart,\r\n                endPos = obj.selectionEnd,\r\n                cursorPos = startPos,\r\n                tmpStr = obj.value;\r\n            obj.value = tmpStr.substring(0, startPos) + img + tmpStr.substring(endPos, tmpStr.length);\r\n            cursorPos += img.length;\r\n            obj.selectionStart = obj.selectionEnd = cursorPos;\r\n        } else {\r\n            obj.value += img;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    handleTextareaChange = (evt) => {\r\n        this.setState({\r\n            textareaValue: evt.target.value\r\n        })\r\n    }\r\n\r\n    leftTRScorll = (event) => {\r\n\r\n        if (event.target.scrollHeight - event.target.clientHeight === event.target.scrollTop) {\r\n            console.log('底部');\r\n            this.right_show.scrollTop = this.right_show.scrollHeight - this.right_show.clientHeight;\r\n            return;\r\n        }\r\n        let mdDivHeight = this.right_show.scrollHeight;\r\n        let textAreaHeight = this.left_input.scrollHeight;\r\n        let scaleSize = mdDivHeight / textAreaHeight;\r\n\r\n        if (scaleSize > 1) {\r\n            scaleSize = scaleSize * 0.9;\r\n        }\r\n\r\n        this.right_show.scrollTop = event.target.scrollTop * scaleSize;\r\n    }\r\n\r\n}"],"sourceRoot":""}